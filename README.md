# <img width="32" height="32" src="https://github.com/user-attachments/assets/07d946a6-a868-4683-9d0d-1ec349290672" /> å·¥æ¥­ç‰©è¯ç¶²æ¨ç´ ![GitHub watchers](https://img.shields.io/github/watchers/FongYuanChen/IIoTHub) ![GitHub forks](https://img.shields.io/github/forks/FongYuanChen/IIoTHub) ![GitHub Repo stars](https://img.shields.io/github/stars/FongYuanChen/IIoTHub) ![GitHub last commit](https://img.shields.io/github/last-commit/FongYuanChen/IIoTHub) ![GitHub License](https://img.shields.io/github/license/FongYuanChen/IIoTHub)

**å·¥å» è¨­å‚™ç›£æ§èˆ‡è³‡æ–™æ•´åˆä¸­æ¨ï¼**

> éš¨è‘—å·¥å» è‡ªå‹•åŒ–ç¨‹åº¦æå‡ï¼Œè¨­å‚™ç¨®é¡èˆ‡æ•¸é‡æŒçºŒçš„å¢åŠ ï¼Œä¸åŒè¨­å‚™ã€é€šè¨Šæ–¹å¼èˆ‡è³‡æ–™æ ¼å¼çš„æ•´åˆï¼Œæˆç‚ºç¾å ´ç³»çµ±å»ºç½®èˆ‡ç¶­è­·ä¸Šçš„ä¸€å¤§æŒ‘æˆ°ã€‚ç¼ºä¹çµ±ä¸€çš„ç®¡ç†æ ¸å¿ƒï¼Œå¾€å¾€å°è‡´ç³»çµ±è€¦åˆåº¦é«˜ã€æ“´å……å›°é›£ï¼Œå¢åŠ å¾ŒçºŒç¶­é‹æˆæœ¬ã€‚

> æœ¬å°ˆæ¡ˆä»¥ã€Œå¯æ“´å……çš„è¨­å‚™é©…å‹•æ¶æ§‹ã€ç‚ºæ ¸å¿ƒï¼Œæ‰“é€ ä¸€å€‹å·¥æ¥­ç‰©è¯ç¶²æ¨ç´ï¼Œé›†ä¸­ç®¡ç†è¨­å‚™ç‹€æ…‹ã€é‹è¡Œç´€éŒ„èˆ‡å³æ™‚è³‡æ–™ã€‚åœ¨æ­¤æ¶æ§‹ä¸‹ï¼Œæ–°å¢æˆ–èª¿æ•´è¨­å‚™åƒ…éœ€å¯¦ä½œå°æ‡‰çš„é©…å‹•æ¨¡çµ„ï¼Œå³å¯ç„¡ç¸«æ•´åˆè‡³ç¾æœ‰ç³»çµ±ï¼Œä½¿æ•´é«”å¹³å°èƒ½éš¨è‘—è¨­å‚™ç¨®é¡èˆ‡å·¥å» éœ€æ±‚çš„è®ŠåŒ–æŒçºŒæ“´å……ã€‚


## ğŸ¨ åŠŸèƒ½ç‰¹è‰²

- **è¨­å‚™ç›£æ§ç¸½è¦½**ï¼šçµ±ä¸€æŒæ¡å·¥å» å…§å¤šç¨®è¨­å‚™çš„ç‹€æ…‹ã€é‹è¡Œç´€éŒ„èˆ‡å³æ™‚è³‡æ–™ï¼Œæä¾›å®Œæ•´çš„ç›£æ§è¦–åœ–ã€‚
- **å¯æ“´å……é©…å‹•æ¶æ§‹**ï¼šè¨­å‚™é€šè¨Šé‚è¼¯ä»¥æ¨¡çµ„åŒ–é©…å‹•å¯¦ä½œï¼Œæ–°å¢æˆ–èª¿æ•´è¨­å‚™åƒ…éœ€æ“´å……å°æ‡‰é©…å‹•ï¼Œç„¡éœ€ä¿®æ”¹æ ¸å¿ƒç³»çµ±ã€‚
- **å¤šè¨­å‚™ã€å¤šå”è­°æ”¯æ´**ï¼šæ•´åˆä¸åŒé€šè¨Šå”è­°èˆ‡è¨­å‚™é¡å‹ï¼Œéˆæ´»æ‡‰å°å·¥å» éœ€æ±‚ã€‚


## ğŸ”— æ•¸æ“šä¾†æº

- **é€šè¨Šå”è­°æ”¯æ´**ï¼šæ”¯æ´ Modbusã€OPC UAã€MQTT ç­‰å¤šç¨®é€šç”¨å·¥æ¥­å”è­°ã€‚
- **å°ˆç”¨SDKæ•´åˆ**ï¼šæ•´åˆ Focasï¼ˆFanuc CNCï¼‰ã€FCSB1224W000ï¼ˆMitsubishi CNCï¼‰ã€MMLï¼ˆMakino CNCï¼‰ç­‰å¤šç¨®å°ˆç”¨ SDKã€‚
- **å¤–éƒ¨ç³»çµ±æ¥å…¥**ï¼šå¯æ¥å…¥ MESã€ERP æˆ–å…¶ä»–å·¥å» è³‡è¨Šç³»çµ±ï¼Œæ“´å±•è³‡æ–™ä¾†æºèˆ‡ç®¡ç†èƒ½åŠ›ã€‚


## ğŸ›  æ ¸å¿ƒæŠ€è¡“

- **èªè¨€æ¡†æ¶**ï¼šåŸºæ–¼ C#ã€.NET 8ã€WPFï¼Œæ¡ MVVM æ¶æ§‹è¨­è¨ˆã€‚
- **ä¾è³´æ³¨å…¥èˆ‡æœå‹™ç®¡ç†**ï¼šä½¿ç”¨ [Microsoft.Extensions.DependencyInjection](https://github.com/dotnet/runtime) èˆ‡ [Microsoft.Extensions.Hosting](https://github.com/dotnet/runtime) ç®¡ç†æœå‹™ç”Ÿå‘½é€±æœŸèˆ‡æ¨¡çµ„åŒ–é©…å‹•æ¶æ§‹ã€‚
- **è¨­å®šç®¡ç†èˆ‡æŒä¹…åŒ–**ï¼šä½¿ç”¨ [Newtonsoft.Json](https://github.com/JamesNK/Newtonsoft.Json) é€²è¡Œè³‡æ–™åºåˆ—åŒ–èˆ‡è¨­å®šå­˜å–ã€‚
- **è³‡æ–™ç®¡ç†èˆ‡æŒä¹…åŒ–**ï¼šä½¿ç”¨ [Microsoft.Data.Sqlite](https://github.com/dotnet/dotnet) å„²å­˜æ­·å²é‹è¡Œç´€éŒ„ã€‚
- **é€šçŸ¥å€åœ–ç¤ºèˆ‡æ“ä½œ**ï¼šä½¿ç”¨ [Hardcodet.NotifyIcon.Wpf](https://github.com/hardcodet/wpf-notifyicon) å»ºç«‹é€šçŸ¥å€åœ–ç¤ºåŠå³éµé¸å–®ï¼Œæä¾›å¿«æ·æ“ä½œã€‚


## ğŸ§© æ“´å……é©…å‹•æŒ‡å—

1. åœ¨ `IIoTHub.Infrastructure` å°ˆæ¡ˆçš„ `Drivers` è³‡æ–™å¤¾å»ºç«‹æ–°é©…å‹•é¡åˆ¥ã€‚
2. æ ¹æ“šè¨­å‚™é¡å‹å¯¦ä½œå°æ‡‰ä»‹é¢ï¼š
   - æ©Ÿå°é©…å‹•ï¼šå¯¦ä½œ `IMachineDriver`
   - æ–™åº«é©…å‹•ï¼šå¯¦ä½œ `IMagazineDriver`
   - æ©Ÿæ¢°æ‰‹è‡‚é©…å‹•ï¼šå¯¦ä½œ `IRobotDriver`
3. é©…å‹•é€£ç·šè¨­å®š
   - ä½¿ç”¨ `[ConnectionSetting]` å±¬æ€§æ¨™è¨˜é©…å‹•ä¸­çš„é€£ç·šç›¸é—œå±¬æ€§ï¼Œé€™äº›å±¬æ€§æœƒåœ¨ç³»çµ± UI é¡¯ç¤ºçµ¦ä½¿ç”¨è€…è¨­å®šã€‚
   - ç¯„ä¾‹ï¼š
     ```csharp
     [ConnectionSetting("è¨­ç½®ä¸€", "æ¸¬è©¦é¡¯ç¤ºç”¨ï¼Œç„¡éœ€è¨­ç½®", "-")]
     public string ConnectionSettingTest1 { get; set; }
     ```
   - åƒæ•¸èªªæ˜ï¼š
     1. ç¬¬ä¸€å€‹å­—ä¸²ï¼šé¡¯ç¤ºåç¨±
     2. ç¬¬äºŒå€‹å­—ä¸²ï¼šèªªæ˜æ–‡å­—
     3. ç¬¬ä¸‰å€‹å­—ä¸²ï¼šé è¨­å€¼

4. é©…å‹•è®Šæ•¸è¨­å®š
   - ä½¿ç”¨ `[VariableSettingAttribute]` æ¨™è¨˜é©…å‹•ä¸­å¯èª¿æ•´çš„é‹è¡Œåƒæ•¸ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥åœ¨ç³»çµ± UI ä¸­ä¿®æ”¹ã€‚
   - ç¯„ä¾‹ï¼š
     ```csharp
     [VariableSettingAttribute("å¿«ç…§è®Šæ›´é–“éš”", "å–®ä½: ç§’", "60")]
     public int SnapshotChangeInterval { get; set; } = 60;
     ```
   - åƒæ•¸èªªæ˜ï¼š
     1. ç¬¬ä¸€å€‹å­—ä¸²ï¼šåƒæ•¸åç¨±
     2. ç¬¬äºŒå€‹å­—ä¸²ï¼šèªªæ˜æ–‡å­—
     3. ç¬¬ä¸‰å€‹å­—ä¸²ï¼šé è¨­å€¼

5. ç¯„ä¾‹é©…å‹•ï¼ˆDemoDriver)
   ```csharp
   public class DemoDriver : IMachineDriver
   {
       public string DisplayName => "DEMO å°ˆç”¨é©…å‹•å™¨";

       [ConnectionSetting("è¨­ç½®ä¸€", "æ¸¬è©¦é¡¯ç¤ºç”¨ï¼Œç„¡éœ€è¨­ç½®", "-")]
       public string ConnectionSettingTest1 { get; set; }

       [VariableSettingAttribute("å¿«ç…§è®Šæ›´é–“éš”", "å–®ä½: ç§’", "60")]
       public int SnapshotChangeInterval { get; set; } = 60;

       private readonly Random _random = new();
       private readonly Dictionary<Guid, DeviceRunStatus> _currentStatus = new();
       private readonly Dictionary<Guid, DateTime> _lastUpdate = new();

       public DeviceSnapshot GetSnapshot(DeviceSetting deviceSetting)
       {
           var variableSetting = deviceSetting.DriverSetting.VariableSettings
                                     .FirstOrDefault(v => v.Key == nameof(SnapshotChangeInterval));
           var interval = int.TryParse(variableSetting?.Value, out int parsed) ? parsed : SnapshotChangeInterval;
           var now = DateTime.Now;

           if (!_lastUpdate.ContainsKey(deviceSetting.Id))
           {
               _lastUpdate[deviceSetting.Id] = now;
               _currentStatus[deviceSetting.Id] = RandomStatus();
           }
           else if ((now - _lastUpdate[deviceSetting.Id]).TotalSeconds >= interval)
           {
               _currentStatus[deviceSetting.Id] = RandomStatus();
               _lastUpdate[deviceSetting.Id] = now;
           }

           var status = _currentStatus[deviceSetting.Id];
           return new DeviceSnapshot
           {
               DeviceId = deviceSetting.Id,
               RunStatus = status
           };
       }

       private DeviceRunStatus RandomStatus()
       {
           var values = Enum.GetValues(typeof(DeviceRunStatus));
           return (DeviceRunStatus)values.GetValue(_random.Next(values.Length));
       }
   }


## ğŸ–¥ï¸ æ“ä½œæ¼”ç¤º

https://github.com/user-attachments/assets/5c51bf94-e111-4b3c-8cd9-7b19fcc2e683


## ğŸ“œ æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ [MIT](https://github.com/FongYuanChen/IIoTHub/blob/main/LICENSE) æˆæ¬Šæ¢æ¬¾ã€‚æ­¡è¿è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹èˆ‡åˆ†äº«ï¼
